\chapter{Probability concepts. Black-Scholes formula. Greeks and Hedging.}

\section{Discrete probability concepts}
Let $ S = \{ s_1, s_2, ..., s_n \} $ be a finite set and let
    $ P : S \rightarrow [0, 1] $ be a probability function defined on $ S $,
    i.e., a function with the following properites:
\begin{equation}
    P(s_i) \geq 0,\ \forall i = 1 : n, \quad \text{and}
        \sum_{i=1}^{n} P(s_i) = 1.
    \label{eq:probability-distribution}
\end{equation}
Any function $ X : S \rightarrow \mathbb{R} $ is called a random variable
    defined on the set of outcomes $ S $.

\begin{definition}
    Let $ X : S \rightarrow \mathbb{R} $ be a random variable on the set $ S $
        endowed with a probability function $ P : S \rightarrow [0, 1] $.
    The expected value $ E[X] $ of $ X $ (also called the mean of $ X $) is
    \begin{equation}
        E[X] = \sum_{i=1}^{n} P(s_i) X(s_i).
        \label{eq:expected-value}
    \end{equation}
    The variance $ var(X) $ of $ X $ is
    \begin{equation}
        var(X) = E[(X - E[X])^2].
        \label{eq:variance}
    \end{equation}
    The standard deviation of $ \sigma(X) $ of $ X $ is
    \begin{equation}
        \sigma(x) = \sqrt{var(X)}.
        \label{eq:standard-deviation}
    \end{equation}
\end{definition}

\begin{lemma}
    Let $ X : S \rightarrow \mathbb{R} $ be a random variable on the set $ S $
        endowed with a probability function $ P : S \rightarrow [0, 1] $.
    Then,
    \begin{equation*}
        var(X) = E[X^2] - (E[X])^2 = \sum_{i=1}^{n} P(s_i) (X(s_i))^2 -
            (E[X])^2.
    \end{equation*}
\end{lemma}

\section{Continuous probability concepts}
Let $ S $ be a set, and consider a family $ \mathbb{F} $ of subsets of $ S $
    such that
\begin{enumerate}
    \item $ S \in \mathbb{F}; $
    \item if $ A \in \mathbb{F} $, then $ S \setminus A \in \mathbb{F} $;
    \item if $ A_k \in \mathbb{F} $, $ k=1:\infty $, then
        $ \bigcup_{k=1}^{\infty} A_k \in \mathbb{F} $.
\end{enumerate}

The set $ S $ represents the sample space, any element of $ S $ is a possible
    outcome, and a set $ A \in \mathbb{F} $ is an event, i.e., a collection of
    possible outcomes.

A probability function $ P : \mathbb{F} \rightarrow [0, 1] $ defined
    $ \mathbb{F} $ is a nonnegative function such that $ P(S) = 1 $ and
\begin{equation*}
    P \left( \bigcup_{k=1}^{\infty} A_k \right) = \sum_{k=1}^{\infty} P(A_k),
        \quad \forall A_k \in \mathbb{F}, k = 1 : \infty,
        \quad \forall A_i \cap A_j = \emptyset, i \neq j.
\end{equation*}

A function $ X : S \rightarrow \mathbb{R} $ is called a random variable if
\begin{equation*}
    \{ s \in S\ \text{such that}\ X(s) \leq t \} \in \mathbb{F}, \quad
        \forall t \in \mathbb{R}.
\end{equation*}

The cumulative distribution function $ F : \mathbb{R} \rightarrow [0, 1] $ of
    the random variable $ X $ is defined as
\begin{equation}
    F(t) = P(X \leq t).
\end{equation}

For any random variable $ X $ considered here, we assume that $ X $ has a
    probability density function $ f(x) $, i.e., we assume that there exists a
    function $ f : \mathbb{R} \rightarrow \mathbb{R} $ such that
\begin{equation}
    P(a \leq X \leq b) = \int_{a}^{b} f(x) dx.
\end{equation}

For an integrable function $ f(x) $ to be the probability density function of a
    random variable, it is necessary and sufficient that $ f(x) \geq 0 $, for
    all $ x \in \mathbb{R} $, and
\begin{equation}
    \int_{-\infty}^{\infty} f(x) dx = 1.
\end{equation}

\begin{lemma}
    Let $ f(x) $ be the probability density function of the random variable
        $ X $.
    Then the cumulative distribution function of $ X $ can be written as
    \begin{equation}
        F(t) = \int_{-\infty}^{t} f(x) dx.
        \label{eq:cumulative-distribution-function}
    \end{equation}
\end{lemma}

\begin{definition}
    Let $ f(x) $ be the probability density function of the random variable
        $ X $.
    The expected value $ E[X] $ of $ X $ (also called the mean of $ X $) is
        defined as
    \begin{equation}
        E[X] = \int_{-\infty}^{\infty} x f(x) dx.
        \label{eq:continuous-expected-value}
    \end{equation}
\end{definition}
The expected value of a random variable is a linear operator:
\begin{lemma}
    Let $ X $ and $ Y $ be two random variables over the same probability
        space.
    Then
    \begin{align}
        E[X + Y] &= E[X] + E[Y]; \\
        E[cX] &= c E[X], \quad \forall c \in \mathbb{R}.
    \end{align}
\end{lemma}

\begin{lemma}
    Let $ h : \mathbb{R} \rightarrow \mathbb{R} $ be a piecewise continuous
        function, and let $ X : S \rightarrow \mathbb{R} $ be a random
        variable with probability density function $ f(x) $ such that
        $ \int_{\mathbb{R}} | h(x) | f(x) dx < \infty $.
    Then $ h(X) : S \rightarrow \mathbb{R} $ is a random variable and the
        expected value of $ h(X) $ is
    \begin{equation}
        E[h(X)] = \int_{-\infty}^{\infty} h(x) f(x) dx.
        \label{eq:piecewise-continuous-expected-value}
    \end{equation}
\end{lemma}

\subsection{Variance, covariance, and correlation}
\begin{definition}
    Let $ f(x) $ be the probability density function of the random variable
        $ X $, and assume that $ \int_{\mathbb{R}} x^2 f(x) dx < 0 $.
    Let $ m = E[X] $ denote the expected value of $ X $.
    The variance $ var(X) $ of $ X $ is defined as
    \begin{equation}
        var(X) = E[(X - E[X])^2] = \int_{-\infty}^{\infty} (x - m)^2 f(x) dx.
        \label{eq:continuous-variance}
    \end{equation}
    The standard deviation $ \sigma(X) $ of $ X $ is defined as
    \begin{equation}
        \sigma(X) = \sqrt{var(X)}.
        \label{eq:continuous-standard-deviation}
    \end{equation}
    Therefore, $ var(X) = (\sigma(X))^2 = \sigma^2(X) $.
\end{definition}

From \eqref{eq:continuous-variance} and
    \eqref{eq:continuous-standard-deviation}, it is easy to see that
\begin{align}
    var(c X) &= c^2 var(X), \quad \forall c \in \mathbb{R}; \\
    \sigma(c X) &= |c| \sigma(X), \quad \forall c \in \mathbb{R}.
\end{align}

\begin{lemma}
    If $ X $ is a random variable, then
    \begin{equation*}
        var(X) = E[X^2] - (E[X])^2.
    \end{equation*}
\end{lemma}

\begin{definition}
    Let $ X $ and $ Y $ be two random variables over the sample probability
        space.
    The covariance $ cov(X, Y) $ of $ X $ and $ Y $ is defined as
    \begin{equation}
        cov(X, Y) = E[(X - E[X]) (Y - E[Y])].
        \label{eq:continuous-covariance}
    \end{equation}
    The correlation $ corr(X, Y) $ between $ X $ and $ Y $ is equal to the
        covariance of $ X $ and $ Y $ normalized with respect to the standard
        deviations of $ X $ and $ Y $, i.e.,
    \begin{equation}
        corr(X, Y) = \frac{cov(X, Y)}{\sigma(X) \sigma(Y)},
        \label{eq:continuous-correlation}
    \end{equation}
    where $ \sigma(X) $ and $ \sigma(Y) $ are the standard deviations of $ X $
        and $ Y $, respectively.
\end{definition}

\begin{lemma}
    Let $ X $ and $ Y $ be two random variables over the same probability space.
    Then
    \begin{equation}
        cov(X, Y) = E[XY] - E[X]E[Y].
    \end{equation}
\end{lemma}

\begin{lemma}
    Let $ X $ and $ Y $ be two random variables over the same probability space.
    Then
    \begin{equation}
        var(X + Y) = var(X) + 2 cov(X, Y) + var(Y),
    \end{equation}
    or, equivalently,
    \begin{equation}
        var(X + Y) = \sigma^2(X) + 2 \sigma(X) \sigma(Y) corr(X, Y) +
            \sigma^2(Y),
    \end{equation}
    where $ \sigma(X) $ and $ \sigma(Y) $ are the standard deviation of $ X $
        and $ Y $, respectively.
\end{lemma}

The correlation of two random variables contains the same information as the
    covariance, in terms of its sign, but its size is also relevant, since it
    is scaled to adjust for multiplication by constants, i.e.,
\begin{equation}
    corr(c_1 X, c_2 Y) = sign(c_1 c_2) corr(X, Y), \quad
        \forall c_1, c_2 \in \mathbb{R}.
\end{equation}

\begin{lemma}
    Let $ X $ and $ Y $ be two random variables over the same probability space.
    Then
    \begin{equation}
        -1 \leq corr(X, Y) \leq 1.
    \end{equation}
\end{lemma}

\begin{lemma}
    Let $ X_i $, $ i = 1 : n $, be random variables over the same probability
        space, and let $ c_i \in \mathbb{R} $ be real number.
    Then,
    \begin{align}
        E \left[ \sum_{i=1}^{n} c_i X_i \right] &=
            \sum_{i=1}^{n} c_i E[X_i]; \\
        var \left( \sum_{i=1}^{n} c_i X_i \right) &=
            \sum_{i=1}^{n} c_i^2 var(X_i) + 2 \sum_{i \leq i < j \leq n}
            c_i c_j cov(X_i, X_j).
        \label{eq:multi-var-variance}
    \end{align}
    If $ \rho_{i, j} = corr(X_i, X_j) $, $ 1 \leq i < j \leq n $, is the
        correlation between $ X_i $ and $ X_j $, and if
        $ \sigma_i^2 = var(X_i) $, $ i = 1 : n $, then
        \eqref{eq:multi-var-variance} can be written as
    \begin{equation}
        var \left( \sum_{i=1}^{n} c_i X_i \right) =
            \sum_{i=1}^{n} c_i^2 \sigma_i^2 +
            2 \sum_{i \leq i < j < \leq n} c_i c_j \sigma_i \sigma_j
            corr(X_i, X_j).
    \end{equation}
\end{lemma}

\section{The standard normal variable}
The standard normal variable, denoted by $ Z $, is the random variable with
    probability density function
\begin{equation}
    f(x) = \frac{1}{\sqrt{2 \pi}} e^{-\frac{x^2}{2}}.
    \label{eq:standard-pdf}
\end{equation}

\begin{lemma}
    The standard normal variable has mean 0 and variance 1, i.e.,
    \begin{align}
        E[Z] &= 0; \label{eq:standard-expected-value} \\
        var(Z) &= 1. \label{eq:standard-variance}
    \end{align}
\end{lemma}

\begin{lemma}
    If $ Z $ is the standard normal variable, then $ E[Z^2] = 1 $.
\end{lemma}

\begin{definition}
    Denote by $ N(t) $ the cumulative distribution of the standard normal
        variable $ Z $.
    Then,
    \begin{equation}
        N(t) = P(Z \leq t) = \frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{t}
            e^{-\frac{x^2}{2}} dx.
    \end{equation}
\end{definition}

\begin{lemma}\label{lemma:standard-normal-distribution-symmetry}
    Let $ Z $ be the standard normal variable.
    Then,
    \begin{equation}
        P(Z \geq a) = P(Z \leq -a), \quad \forall a \in \mathbb{R}.
    \end{equation}
    In other words, if $ N(t) $ is the cumulative distribution of $ Z $, then
    \begin{equation}
        1 - N(a) = N(-a), \quad \forall a \in \mathbb{R}.
    \end{equation}
\end{lemma}

\section{Normal random variables}
\begin{definition}
    The random variable $ X $ is a normal variable if and only if
    \begin{equation}
        X = \mu + \sigma Z,
    \end{equation}
    where $ Z $ is the standard normal variable and
        $ \mu, \sigma \in \mathbb{R} $
\end{definition}

\begin{lemma}
    Let $ X = \mu + \sigma Z $ be a normal variable.
    Then
    \begin{align}
        E[X] &= \mu; \\
        var(X) &= \sigma^2; \\
        \sigma(X) = | \sigma |.
    \end{align}
\end{lemma}

\begin{lemma}
    Let $ X = \mu + \sigma Z $ be a normal variable, with $ \sigma \neq 0 $, and
        denote by $ h(x) $ the probability density function of $ X $.
    Then,
    \begin{equation}
        h(x) = \frac{1}{| \sigma  \sqrt{2 \pi}} \exp \left(
            -\frac{(x - \mu)^2}{2 \sigma^2} \right).
    \end{equation}
\end{lemma}

\section{The Black-Scholes formula}
The Black-Scholes formulas give the price of plain vanilla European call and put
    options, under the assumption that the price of the underlying asset has
    lognormal distribution.
For any values of $ t_1 $ and $ t_2 $ with $ t_1 < t_2 $, the random variable
    $ \frac{S(t_2)}{S(t_1)} $ is lognormal with paramaters
    $ \left( \mu - q - \frac{\sigma^2}{2} \right) (t_2 - t_1) $ and
    $ \sigma^2 (t_2 - t_1) $, i.e.,
\begin{equation}
    \ln \left( \frac{S(t_2)}{S(t_1)} \right) = \left( \mu - q -
        \frac{\sigma^2}{2} \right) (t_2 - t_1) + \sigma \sqrt{t_2 - t_1} Z,
\end{equation}
where $ Z $ is the standard normal variable.
The constants $ \mu $ and $ \sigma $ are called the drift and the volatility of
    the price $ S(t) $ of the underlying asset and represent the expected value
    and the standard deviation of the returns of the asset; $ q $ is the
    continuous rate at which the asset pays dividends.

In the Black-Scholes formulas, the price of a plain vanilla European option
    depends on the following parameters:
\begin{itemize}
    \item $ S $, the spot price of the underlying asset at time $ t $;
    \item $ T $, the maturity of the option; note that the time to maturity is
        $ T - t $;
    \item $ K $, the strike price of the option;
    \item $ r $, the risk-free interest rate, assumed to be constant over the
        life of the option, i.e., between $ t $ and $ T $;
    \item $ \sigma $, the volatility of the underlying asset, i.e., the standard
        deviation of the returns of the asset;
    \item $ q $, the dividend rate of the underlying asset; the asset is assumed
        to pay dividends at a continuous rate.
\end{itemize}
Assume that the price of the underlying asset has lognormal distribution and
    volatility $ \sigma $, that the asset pays dividends continuously at the
    rate $ q $, and that the risk-free interest rate is constant and equal to
    $ r $.
Let $ C(S,t) $ be the value at time $ t $ of a call option with strike $ K $
    and maturity $ T $, and let $ P(S,t) $ be the value at time $ t $ of a put
    option with strike $ K $ and maturity $ T $.
Then,
\begin{align}
    C(S, t) &= S e^{-q (T - t)} N(d_1) - Ke^{-r (T - t)} N(d_2);
    \label{eq:black-scholes-call} \\
    P(S, t) &= K e^{-r (T - t)} N(-d_2) - S e^{-q (T - t)} N(-d_1),
    \label{eq:black-scholes-put}
\end{align}
where
\begin{align}
    d_1 &= \frac{\ln \left( \frac{S}{K} \right) + \left( r - q +
        \frac{\sigma^2}{2} \right) (T - t)}{\sigma \sqrt{T - t}};
    \label{eq:black-scholes-drift-1} \\
    d_2 &= d_1 - \sigma \sqrt{T - t} = \frac{\ln \left( \frac{S}{K} \right) +
        \left( r - q - \frac{\sigma^2}{2} \right) (T - t)}{\sigma \sqrt{T - t}}.
    \label{eq:black-scholes-drift-2}
\end{align}
Here, $ N(z) $ is the cumulative distribution of the standard normal variable:
\begin{equation*}
    N(z) = \frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{z} e^{-\frac{x^2}{2}} dx.
\end{equation*}

For a non-dividend paying asset, i.e., $ q = 0 $, the Black-Scholes formulas are
\begin{align}
    C(S, t) &= S N(d_1) - Ke^{-r (T - t)} N(d_2);
    \label{eq:black-scholes-call-non-dividend} \\
    P(S, t) &= K e^{-r (T - t)} N(-d_2) - S N(-d_1),
    \label{eq:black-scholes-put-non-dividend}
\end{align}
where
\begin{align}
    d_1 &= \frac{\ln \left( \frac{S}{K} \right) + \left( r +
        \frac{\sigma^2}{2} \right) (T - t)}{\sigma \sqrt{T - t}};
    \label{eq:black-scholes-non-dividend-drift-1} \\
    d_2 &= d_1 - \sigma \sqrt{T - t} = \frac{\ln \left( \frac{S}{K} \right) +
        \left( r - \frac{\sigma^2}{2} \right) (T - t)}{\sigma \sqrt{T - t}}.
    \label{eq:black-scholes-non-dividend-drift-2}
\end{align}
The general rule of thumb that, for a continuous dividend paying asset with
    dividend rate $ q $, the Black-Scholes formulas
    \eqref{eq:black-scholes-call} and \eqref{eq:black-scholes-put} can be
    obtained from the formulas \eqref{eq:black-scholes-call-non-dividend} and
    \eqref{eq:black-scholes-put-non-dividend} for a non-dividend paying asset
    by substituting $ r - q $ for $ r $, is \textit{wrong}.
While $ r $ represents the risk-neutral drift of the underlying asset in
    \eqref{eq:black-scholes-non-dividend-drift-1} and
    \eqref{eq:black-scholes-non-dividend-drift-2}, and therefore
    \eqref{eq:black-scholes-drift-1} and \eqref{eq:black-scholes-drift-2} can be
    obtained from \eqref{eq:black-scholes-non-dividend-drift-1} and
    \eqref{eq:black-scholes-non-dividend-drift-2} by substituing $ r - q $ for
    $ r $, the term $ e^{-r (T - t)} $ from
    \eqref{eq:black-scholes-call-non-dividend} and
    \eqref{eq:black-scholes-put-non-dividend} is the discount factor from time
    $ T $ to time $ t $ and does not change in the formulas
    \eqref{eq:black-scholes-call} and \eqref{eq:black-scholes-put} corresponding
    to the dividend-paying asset.

If $ V(S(t), K) $ denotes the value at time $ t $ of a plain vanilla options
    with strike $ K $ and spot price $ S(t) $ of the underlying asset, then
    $ V(a S(t), a K) = a V(S(t), K) $ for any $ a > 0 $.
Therefore,
\begin{equation*}
    V(S(t), K) = K V \left( \frac{S(t)}{K}, 1 \right) = K V \left( 1 +
        \frac{S(t) - K}{K}, 1 \right).
\end{equation*}
Thus, the relevant factor when pricing an option with strike $ K $ is
\begin{equation*}
    \frac{S - K}{K} = \frac{S(t) - K}{K},
\end{equation*}
which represents the percentage by which an option is in-the-money or
    out-of-money at time $ t $.

\section{The Greeks of European call and put options}
Let $ V $ be the value of a portfolio of derivative securities on one underlying
    asset.
The rates of change of the value of the portfolio with respect to various
    parameters, e.g., the price of the underlying asset or the volatility of the
    underlying asset, are important for hedging purposes.
The most commonly used rates of change are listed below.
\begin{itemize}
    \item Delta ($ \Delta $) is the rate of change of the value of the value of
        the portfolio with respect to the spot price $ S $ of the underlying
        asset:
        \begin{equation}
            \Delta(V) = \frac{\partial V}{\partial S};
            \label{eq:rate-of-change-of-value-to-price}
        \end{equation}
    \item Gamma ($ \Gamma $) is the rate of change of the Delta of the portfolio
        with respect to the spot price $ S $ of the underlying asset, i.e., the
        second partial derivative of the value of the portfolio with respect to
        $ S $:
        \begin{equation}
            \Gamma(V) = \frac{\partial^2 V}{\partial S^2};
            \label{eq:rate-of-change-of-delta}
        \end{equation}
    \item Theta ($ \Theta $) is the rate of change of the value of the portfolio
        with respect to time $ t $ (not with respect to maturity $ T $):
        \begin{equation}
            \Theta(V) = \frac{\partial V}{\partial t};
            \label{eq:rate-of-change-of-value-to-time}
        \end{equation}
    \item Rho ($ \rho $) is the rate of change of the value of the portfolio
        with respect to the risk-free interest rate $ r $:
        \begin{equation}
            \rho(V) = \frac{\partial V}{\partial r};
            \label{eq:rate-of-change-of-value-to-interest}
        \end{equation}
    \item Vega is the rate of change of the value of the portfolio with respect
        to the volatility $ \sigma $ of the underlying asset:
        \begin{equation}
            \vega(V) = \frac{\partial V}{\partial \sigma}.
            \label{eq:rate-of-change-of-value-to-volatility}
        \end{equation}
\end{itemize}

From the Black-Scholes formulas \eqref{eq:black-scholes-call} and
    \eqref{eq:black-scholes-put} for options on assets paying continuous
    dividends, the following closed formulas for computing the Greeks of
    European plain vanilla call and put options can be derived:
\begin{align}
    \Delta(C) &= e^{-q(T-t)}N(d_1); \label{eq:greeks-delta-call} \\
    \Delta(P) &= -e^{-q(T-t)}N(-d_1); \label{eq:greeks-delta-put}
\end{align}
\begin{align}
    \Gamma(C) &= \frac{e^{-q(T-t)}}{S \sigma \sqrt{T - t}}
        \frac{1}{\sqrt{2 \pi}}e^{-\frac{d_1^2}{2}}; \\
    \Gamma(P) &= \Gamma(C);
\end{align}
\begin{align}
    \Theta(C) &= -\frac{S \sigma e^{-q(T-t)}}{2 \sqrt{2 \pi (T - t)}}
        e^{-\frac{d_1^2}{2}} + q S e^{q(T-t)} N(d_1) -
        r K e^{-r(T-t)} N(d_2); \\
    \Theta(P) &= -\frac{S \sigma e^{-q(T-t)}}{2 \sqrt{2 \pi (T - t)}}
        e^{-\frac{d_1^2}{2}} - q S e^{-q(T-t)} N(-d_1) +
        r K e^{-r(T-t)} N(-d_2);
\end{align}
\begin{align}
    \rho(C) &= K (T - t) e^{-r(T-t)} N(d_2); \\
    \rho(P) &= -K (T - t) e^{-r(T-t)} N(-d_2);
\end{align}
\begin{align}
    \vega(C) &= S e^{-q(T-t)} \sqrt{T - t} \frac{1}{\sqrt{2 \pi}}
        e^{-\frac{d_1^2}{2}}; \\
    \vega(P) &= \vega(C).
\end{align}

Note that, as soon as the formulas for the Greeks corresponding to a call
    option are derive, the Put-Call parity can be used to obtain the
    corresponding Greeks for the put option.
For example, to compute the Delta of a put option, we write the Put-Call parity
    formula \eqref{eq:put-call-parity-dividend} as
\begin{equation}
    P = C - S(t) e^{-q (T - t)} + K e^{-r (T - t)}.
    \label{eq:put-call-parity-greeks}
\end{equation}
By differentiating \eqref{eq:put-call-parity-greeks} with respect to S, we find
    that
\begin{equation*}
    \Delta(P) = \Delta(C) - e^{-q(T-t)}.
\end{equation*}
Using formula \eqref{eq:greeks-delta-call} for $ \Delta(C) $ and Lemma
    \ref{lemma:standard-normal-distribution-symmetry}, we obtain the formula
    \eqref{eq:greeks-delta-put}, i.e.,
\begin{equation*}
    \Delta(P) = e^{-q(T-t)} N(d_1) - e^{-q(T-t)} = -e^{-q(T-t)} (1 - N(d_1)) =
        -e^{-q(T-t)} N(-d_1).
\end{equation*}
