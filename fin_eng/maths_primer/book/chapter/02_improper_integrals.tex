\chapter{Improper integrals. Numerical integration. Interest rates. Bonds.}

\section{Double integrals}
Let $ D \subset \mathbb{R}^2 $ be a bounded region and let
    $ f : D \rightarrow \mathbb{R} $ be a continuous function.
The double integral of $ f $ over $ D $, denoted by
\begin{equation*}
    \int \int_D f,
\end{equation*}
represents the volume of the three dimensional body between the domain $ D $ in
    the two dimensional plane and the graph of the function $ f(x, y) $.

For simplicity, assume that the domain $ D $ is bounded and convex, i.e., for
    any two points $ x_1 $ and $ x_2 $ in $ D $, all the points on the segment
    joining $ x_1 $ and $ x_2 $ are in $ D $ as well.
Also, assume that there exist two continuous functions $ f_1(x) $ and $ f_2(x) $
    such that $ D $ can be described as follow:
\begin{equation}
    D = {(x, y) | a \leq x \leq b \quad \text{and} \quad f_1(x) \leq y \leq
        f_2(x)}.
    \label{eq:bounded-convex-domain}
\end{equation}
The functions $ f_1(x) $ and $ f_2(x) $ are well defined by
    \eqref{eq:bounded-convex-domain} since the domain $ D $ is bounded and
    convex.
Then, by definition,
\begin{equation}
    \int \int_d f(x, y) dy dx = \int_{a}^{b} \left( \int_{f_1(x)}^{f_2(x)}
        f(x, y) dy \right) dx.
    \label{eq:double-integral-yx}
\end{equation}

If there exists two continuous functions $ g_1(x) $ and $ g_2(x) $ such that
    $ D = {(x, y) | c \leq y \leq d\ \text{and}\ g_1(y) \leq x \leq g_2(x)} $,
    then, by definition,
\begin{equation}
    \int \int_D f(x, y) dx dy = \int_{c}^{d} \left( \int_{g_1(y)}^{g_2(y)}
        f(x, y) dx \right) dy.
    \label{eq:double-integral-xy}
\end{equation}

\begin{theorem}[Fubini's Theorem]
    With the notations above, if the function $ f(x, y) $ is continuous, then
        the integrals \eqref{eq:double-integral-yx} and
        \eqref{eq:double-integral-xy} are equal to each other and to the double
        integral of $ f(x, y) $ over $ D $, i.e., the order of integration does
        not matter:
    \begin{equation}
        \int \int_D f = \int \int_D f(x, y) dx dy = \int \int_D f(x, y) dy dx.
        \label{eq:theorem:fubini}
    \end{equation}
\end{theorem}

\section{Improper integrals}
We consider three types of improper integrals:

\paragraph{Type 1}
Integrate the function $ f(x) $ over an infinite interval of the form
    $ [a, \infty) $ or $ (-\infty, b] $.
The integral $ \int_{a}^{\infty} f(x) dx $ exists if and only if the limit as
    $ t \rightarrow \infty $ of the definite integral of $ f(x) $ between $ a $
    and $ t $ exists and is finite.
The integral $ \int_{-\infty}^{b} f(x) dx $ exists if and only if the limit as
    $ t \rightarrow -\infty $ of the definite integral of $ f(x) $ between $ t $
    and $ b $ exists and is finite.
Then
\begin{align*}
    \int_{a}^{\infty} f(x) dx &= \lim_{t \rightarrow \infty} \int_{a}^{t} f(x)
        dx; \\
    \int_{-\infty}^{b} f(x) dx &= \lim_{t \rightarrow -\infty} \int_{t}^{b}
        f(x) dx.
\end{align*}

Adding and subtracting improper integrals of this type follows rules similar to
    those for definite integrals:
\begin{lemma}
    Let $ f : \mathbb{R} \rightarrow \mathbb{R} $ be an integrable function over
        the interval $ [a, \infty) $.
    If $ b > a $, then $ f(x) $ is also integrable over the interval
        $ [b, \infty) $ and
    \begin{equation*}
        \int_{a}^{\infty} f(x) dx - \int_{b}^{\infty} f(x) dx =
            \int_{a}^{b} f(x) dx.
    \end{equation*}
    Let $ f(x) $ be an integrable function over the interval $ (-\infty, b] $.
    If $ a < b $, then $ f(x) $ is also integrable over the interval
        $ (-\infty, a] $ and
    \begin{equation*}
        \int_{-\infty}^{b} f(x) dx - \int_{-\infty}^{a} f(x) dx =
            \int_{a}^{b} f(x) dx.
    \end{equation*}
\end{lemma}

\paragraph{Type 2}
Integrate the function $ f(x) $ over an interval $ [a, b] $ where $ f(x) $ is
    unbounded as $ x $ approaches the end points $ a $ and/or $ b $.
For example, if the limit as $ x \searrow a $ of $ f(x) $ is infinite, then
    $ \int_{a}^{b} f(x) dx $ exists if and only if the limit as $ t searrow a $
    of the definite integral of $ f(x) $ between $ t $ and $ b $ exists and is
    finite, i.e.,
    \begin{equation*}
        \int_{a}^{b} f(x) dx = \lim_{x \searrow a} \int_{t}^{b} f(x) dx.
    \end{equation*}

\paragraph{Type 3}
Integrate the function $ f(x) $ on the entire real axis, i.e., on
    $ (-\infty, \infty) $.
The integral $ \int_{-\infty}^{\infty} f(x) dx $ exists if and only if a real
    number $ a $ such that both $ \int_{-\infty}^{a} f(x) dx $ and
    $ \int_{a}^{\infty} f(x) dx $ exist.
Then,
\begin{align}
    \int_{-\infty}^{\infty} f(x) dx
        &= \int_{-\infty}^{a} f(x) dx + \int_{a}^{\infty} f(x) dx \\
        &= \lim_{t_1 \rightarrow -\infty} \int_{t_1}^{a} f(x) dx +
            \lim_{t_2 \rightarrow \infty} \int_{a}^{t_2} f(x) dx.
            \label{eq:undefined-integral-real-axis}
\end{align}

It is incorrect to use, instead of \eqref{eq:undefined-integral-real-axis}, the
    following definition for the integral $ f(x) $ over the real axis
    $ (-\infty, \infty) $:
\begin{equation}
    \int_{-\infty}^{\infty} f(x) dx = \lim_{t \rightarrow \infty}
        \int_{t}^{t} f(x) dx.
    \label{eq:defined-integral-real-axis}
\end{equation}

However, if we know that the function $ f(x) $ is integrable over the entire
    real axis, then we can use formula \eqref{eq:defined-integral-real-axis} to
    evaluate it:
\begin{lemma}
    If the improper integral $ \int_{-\infty}^{\infty} f(x) dx $ exists, then
    \begin{equation}
        \int_{-\infty}^{\infty} f(x) dx = \lim_{t \rightarrow \infty}
            \int_{-t}^{t} f(x) dx.
        \label{eq:lemma:defined-integral-real-axis}
    \end{equation}
\end{lemma}

\section{Differentiating improper integrals with respect to the integration
    limits}
\begin{lemma}
    Let $ f : \mathbb{R} \rightarrow \mathbb{R} $ be a continuous function such
        that the improper integral $ \int_{-\infty}^{\infty} f(x) dx $ exists.
    Let $ g, h : \mathbb{R} \rightarrow \mathbb{R} $ be given by
    \begin{equation*}
        g(t) = \int_{-\infty}^{b(t)} f(x) dx; \quad
        h(t) = \int_{a(t)}^{\infty} f(x) dx,
    \end{equation*}
    where $ a(t) $ and $ b(t) $ are differentiable functions.
    Then $ g(t) $ and $ h(t) $ are differentiable, and
    \begin{align*}
        g'(t) &= f(b(t)) b'(t); \\
        h'(t) &= -f(a(t)) a'(t).
    \end{align*}
\end{lemma}

\section{Numerical methods for computing definite integrals: Midpoint rule,
    Trapezoidal rule, and Simpson's rule}
Computing the value of a definite integral using the Fundamental Theorem of
    Calculus is not always possible.
The approximate values of the definite integral are computed using numerical
    integration methods in these cases.
We present three of the most common such methods.

Let $ f : [a, b] \rightarrow \mathbb{R} $ be an integrable function.
To compute an approximate value of the integral
\begin{equation*}
    I = \int_{a}^{b} f(x) dx,
\end{equation*}
we partition the interval $ [a, b] $ into $ n $ intervals of equal size
    $ h = \frac{b - a}{h} $ by using the nodes $ a_i = a + i h $, for
    $ i = 0 : n $, i.e.,
\begin{equation*}
    a = a_0 < a_1 < a_2 < ... < a_{n - 1} < a_n = b.
\end{equation*}
Note that $ a_i - a_{i - 1} = h $, $ i = 1 : n $.
Let $ x_i $ be the midpoint of the interval $ [a_{i - 1}, a_i] $, i.e.,
\begin{equation*}
    x_i = \frac{a_{i - 1} + a_i}{2}, \quad \forall i = 1 : n.
\end{equation*}

The integral $ I $ can be written as
\begin{equation}
    I = \sum_{i=1}^{n} \int_{a_{i-1}}^{a_i} f(x) dx.
    \label{eq:integral-interval}
\end{equation}
On each interval $ [a_{i-1}, a_i] $, $ i = 1 : n $, the function $ f(x) $ is
    approximated by a simpler function whose integral on $ [a_{i-1}, a_i] $ can
    be computed exactly.
The resulting values are summed up to obtain an approximate value of $ I $.
Depending on whether constant functions, linear functions, or quadratic
    functions are used to approximate $ f(x) $, the resulting numerical
    integration methods are called the Midpoint rule, the Trapezoidal rule, and
    the Simpson's rule, respectively.

\paragraph{Midpoint rule}
Approximate $ f(x) $ on the interval $ [a_{i-1}, a_i] $ by the constant function
    $ c_i(x) $ equal to the value of the function $ f $ at the midpoint $ x_i $
    of the interval $ [a_{i-1}, a_i] $, i.e.,
\begin{equation}
    c_i(x) = f(x_i), \quad \forall x \in [a_{i-1}, a_i].
    \label{eq:midpoint-constant-function}
\end{equation}
Then,
\begin{equation}
    \int_{a_{i-1}}^{a_i} f(x) dx \approx \int_{a_{i-1}}^{a_i} c_i(x) dx =
        (a_i - a_{i-1}) f(x_i) = h f(x_i).
    \label{eq:midpoint-integration-approximation}
\end{equation}
From \eqref{eq:integral-interval} and
    \eqref{eq:midpoint-integration-approximation}, we obtain that the Midpoint
    Rule approximation $ I_n^M $ of $ I $ corresponding to $ n $ partition
    intervals is
\begin{align}
    \begin{split}
        I_n^M &= \sum_{i=1}^{n} \int_{a_{i-1}}^{a_i} c_i(x) dx \\
              &=  h \sum_{i=1}^{n} f(x_i).
        \label{eq:midpoint-rule-sum}
    \end{split}
\end{align}

\paragraph{Trapezoidal Rule}
Approximate $ f(x) $ on the interval $ [a_{i-1}, a_i] $ by the linear function
    $ l_i(x) $ equal to $ f(x) $ at the end points $ a_{i-1} $ and $ a_i $,
    i.e.,
\begin{equation*}
    l_i(a_{i-1}) = f(a_{i-1}) \quad \text{and} \quad l_i(a_i) = f(a_i).
\end{equation*}
By linear interpolation, it is easy to see that
\begin{equation}
    l_i(x) = \frac{x - a_{i-1}}{a_i - a_{i-1}} f(a_i) +
        \frac{a_i - x}{a_i - a_{i-1}} f(a_{i-1}), \quad
        \forall x \in [a_{i-1}, a_i].
    \label{eq:trapezoidal-linear-function}
\end{equation}
Then,
\begin{equation}
    \int_{a_{i-1}}^{a_i} f(x) dx \approx \int_{a_{i_1}}^{a_i} l_i(x) dx =
        \frac{h}{2} (f(a_{i-1}) + f(a_i)).
    \label{eq:trapezoidal-rule-approximation}
\end{equation}
From \eqref{eq:integral-interval} and \eqref{eq:trapezoidal-rule-approximation},
    we obtain that the Trapezoidal Rule approximation $ I_n^T $ of $ I $
    corresponding to $ n $ partition intervals is
\begin{align}
    \begin{split}
        I_n^T
            &= \sum_{i=1}^{n} \int_{a_{i-1}}^{a_i} l_i(x) dx \\
            &= \frac{h}{2} \left( f(a_0) + 2 \sum_{i=1}^{n-1} f(a_i) +
                f(a_n) \right)
        \label{eq:trapezoidal-rule-sum}
    \end{split}
\end{align}

\paragraph{Simpson's Rule}
Approximate $ f(x) $ on the interval $ [a_{i-1}, a_i] $ by the quadratic
    function $ q_i(x) $ equal to $ f(x) $ at $ a_{i-1} $, $ a_i $, and at the
    midpoint $ x_i = \frac{a_{i-1} - a_i}{2} $, i.e.,
\begin{equation*}
    q_i(a_{i-1}) = f(a_{i-1}); q_i(x_i) = f(x_i) \quad \text{and} \quad
        q_i(a_i) = f(a_i).
\end{equation*}
By quadratic interpolation, we find that
\begin{align}
    \begin{split}
        q_i(x)
            =& \frac{(x - a_{i-1})(x - x_i)}{(a_i - a_{i-1})(a_i - x_i)}
                f(a_i) + \frac{(a_i - x)(x - a_{i-1}}{(a_i - x_i)(x_i -
                a_{i-1})} f(x_i) \\
             &+ \frac{(a_i - x)(x_i - x)}{(a_i - a_{i-1})} f(a_{i-1}), \quad
                \forall x \in [a_{i-1}, a_i].
        \label{eq:simpsons-quadratic-function}
    \end{split}
\end{align}
Then,
\begin{equation}
    \int_{a_{i-1}}^{a_i} f(x) dx \approx \int_{a_{i-1}}^{a_i} q_i(x) dx =
        \frac{h}{6} (f(a_{i-1}) + 4 f(x_i) + f(a_i)).
    \label{eq:simpsons-rule-approximation}
\end{equation}
From \eqref{eq:integral-interval} and \eqref{eq:simpsons-rule-approximation},
    we obtain that the Simpson's Rule approximation $ I_n^S $ of $ I $
    corresponding to $ n $ partition intervals is
\begin{align}
    \begin{split}
        I_n^S
            &= \sum_{i=1}^{n} \int_{a_{i-1}}^{a_i} q_i(x) dx \\
            &= \frac{h}{6} \left( f(a_0) + 2 \sum_{i=1}^{n-1} f(a_i) + f(a_n) +
                4 \sum_{i=1}^{n} f(x_i) \right).
        \label{eq:simpsons-rule-sum}
    \end{split}
\end{align}

\section{Convergence of the Midpoint, Trapezoidal, and Simpson's rules}

We derived the formulas \eqref{eq:midpoint-rule-sum},
    \eqref{eq:trapezoidal-rule-sum}, and \eqref{eq:simpsons-rule-sum} for
    computing approximate values $ I_n^M $, $ I_n^T $, and $ I_n^S $ of the
    integral
\begin{equation*}
    I = \int_{a}^{b} f(x) dx
\end{equation*}
corresponding to the Midpoint, Trapezoidal, and Simpson's rules, respectively.
In this section, we discuss the convergence of these methods.

\begin{definition}
    Denote by $ I_n $ the approximation of $ I $ obtained using a numerical
        integration method with $ n $ partition integrals.
    The method is convergent if and only if the approximation $ I_n $ converge
        to I as the number of intervals $ n $ goes to infinity (and therefore
        as $ h = \frac{b - a}{h} $ goes to 0), i.e.,
    \begin{equation*}
        \lim_{n \rightarrow \infty} | I - I_n | = 0.
    \end{equation*}
    The order of convergence of the numerical integration method is $ k > 0 $
        if and only if
    \begin{equation*}
        | I - I_n | = O(h^k) = O \left( \frac{1}{n^k} \right).
    \end{equation*}
\end{definition}

\begin{theorem}
    Let $ I = \int_{a}^{b} f(x) dx $, and let $ I_n^M $, $ I_n^T $, or
        $ I_n^S $ be the approximations of $ I $ given by the Midpoint,
        Trapezoidal, and Simpson's rules corresponding to $ n $ partition
        intervals of size $ h = \frac{b - a}{n} $.

    (i) If $ f''(x) $ exists and is continuous on $ [a, b] $, then the
        approximation errors of the Midpoint and Trapezoidal rules can be
        bounded from above as follows:
    \begin{align}
        | I - I_n^M | &\leq \frac{h^2}{24} (b - a)
            \max_{a \leq x \leq b} | f''(x) |;
            \label{eq:midpoint-rule-upper-bound} \\
        | I - I_n^T | &\leq \frac{h^2}{12} (b - a)
            \max_{a \leq x \leq b} | f''(x) |.
            \label{eq:trapezoidal-rule-upper-bound}
    \end{align}
    Thus, the Midpoint and Trapezoidal rules are quadratically convergent, i.e.,
    \begin{align}
        | I - I_n^M | &= O \left( \frac{1}{n^2} \right), \quad
            \text{as}\quad n \rightarrow \infty; \\
        | I - I_n^T | &= O \left( \frac{1}{n^2} \right), \quad
            \text{as}\quad n \rightarrow \infty. \\
    \end{align}

    (ii) If $ f^{(4)}(x) $ exists and is continuous on $ [a, b] $, then
    \begin{equation}
        | I - I_n^S | \leq \frac{h^4}{2880} (b - a)
            \max_{a \leq x \leq b} | f^{(4)}(x) |,
        \label{eq:simpsons-rule-upper-bound}
    \end{equation}
    and Simpson's rule is fourth order convergent, i.e.,
    \begin{equation}
        | I - I_n^S |  O \left( \frac{1}{n^4} \right), \quad
            \text{as}\quad n \rightarrow \infty.
    \end{equation}
\end{theorem}

The upper bounds \eqref{eq:midpoint-rule-upper-bound},
    \eqref{eq:trapezoidal-rule-upper-bound}, and
    \eqref{eq:simpsons-rule-upper-bound} can be established using the following
    approximation error results: For any $ i = 1 : n $, there exist points
    $ \xi_{i,T} $, $ \xi_{i,M} $, and $ \xi_{i,S} $ in the interval
    $ (a_{i-1}, a_i) $ such that
\begin{align}
    \int_{a_{i-1}}^{a_i} f(x) dx - \int_{a_{i-1}}^{a_i} c_i(x) dx &=
        \frac{h^3}{24} f''(\xi_{i,T}); \\
    \int_{a_{i-1}}^{a_i} f(x) dx - \int_{a_{i-1}}^{a_i} l_i(x) dx &=
        -\frac{h^3}{12} f''(\xi_{i,M}); \\
    \int_{a_{i-1}}^{a_i} f(x) dx - \int_{a_{i-1}}^{a_i} q_i(x) dx &=
        -\frac{h^5}{2880} f^{(4)}(\xi_{i,S}),
\end{align}
where $ c_i(x) $, $ l_i(x) $, and $ q_i(x) $ are given by
    \eqref{eq:midpoint-constant-function},
    \eqref{eq:trapezoidal-linear-function}, and
    \eqref{eq:simpsons-quadratic-function}, respectively.

\subsection{Implementation of numerical integration methods}
Computing approximate values of the definite integral of a given function
    $ f(x) $ on the interval $ [a, b] $ using the Midpoint, Trapezoidal, or
    Simpson's rules requires implementation of formulas
    \eqref{eq:midpoint-rule-sum}, \eqref{eq:trapezoidal-rule-sum}, and
    \eqref{eq:simpsons-rule-sum}, i.e.,
\begin{align}
    I_n^M &= h \sum_{i=1}^{n} f(x_i); \\
    I_n^T &= h \left( \frac{f(a_0)}{2} + \frac{f(a_n)}{2} \right) +
        h \sum_{i=1}^{n-1} f(a_i); \\
    I_n^S &= h \left( \frac{f(a_0)}{6} + \frac{f(a_n)}{6} \right) +
        \frac{h}{3} \sum_{i=1}^{n-1} f(a_i) +
        \frac{2h}{3} \sum_{i=1}^{n} f(x_i). \\
\end{align}
Here, $ h = \frac{b-a}{n} $, $ a_i = a + i h $, $ i = 0:n $, and
    $ x_i = a + \left( i - \frac{1}{2} \right) h $, $ i = 1:n $.

A routine f\_int($ x $) evaluating the function to be integrated at the point
    $ x $ is required.
The end points $ a $ and $ b $ of the integration interval and the number of
    intervals $ n $ must also be specified.

\begin{algorithm}
    \caption{Pseudocode for Midpoint Rule}
    \begin{algorithmic}
        \State{Input:}
        \State{$ a $ = left endpoint of the integration interval}
        \State{$ b $ = right endpoint of the integration interval}
        \State{$ n $ = number of partition interval}
        \State{f\_int($ x $) = routine evaluating $ f(x) $}

        \State{}

        \State{Output:}
        \State{I\_midpoint = Midpoint Rule approximation of $ \int_{a}^{b} f(x) $}

        \State{}

        \State{$ h = (b - a) / n $; I\_midpoint = 0}
        \For{$ i = 1 : n $}
            \State{I\_midpoint = I\_midpoint + f\_int($ a + (i - 1 / 2) h $)}
        \EndFor
        \State{I\_midpoint = h $ \cdot $ I\_midpoint}
    \end{algorithmic}
\end{algorithm}

\begin{algorithm}
    \caption{Pseudocode for Trapezoidal Rule}
    \begin{algorithmic}
        \State{Input:}
        \State{$ a $ = left endpoint of the integration interval}
        \State{$ b $ = right endpoint of the integration interval}
        \State{$ n $ = number of partition interval}
        \State{f\_int($ x $) = routine evaluating $ f(x) $}

        \State{}

        \State{Output:}
        \State{I\_trap = Trapezoidal Rule approximation of
            $ \int_{a}^{b} f(x) $}

        \State{}

        \State{$ h = (b - a) / n $; I\_midpoint = 0}
        \State{I\_trap = f\_int(a) / 2 + f\_int(b) / 2}
        \For{$ i = 1 : (n-1) $}
            \State{I\_trap = I\_trap + f\_int($ a + i h $)}
        \EndFor
        \State{I\_trap = h $ \cdot $ I\_trap}
    \end{algorithmic}
\end{algorithm}

\begin{algorithm}
    \caption{Pseudocode for Simpson's Rule}
    \begin{algorithmic}
        \State{Input:}
        \State{$ a $ = left endpoint of the integration interval}
        \State{$ b $ = right endpoint of the integration interval}
        \State{$ n $ = number of partition interval}
        \State{f\_int($ x $) = routine evaluating $ f(x) $}

        \State{}

        \State{Output:}
        \State{I\_simpson = Simpson's Rule approximation of
            $ \int_{a}^{b} f(x) $}

        \State{}

        \State{$ h = (b - a) / n $; I\_midpoint = 0}
        \State{I\_simpson = f\_int(a) / 6 + f\_int(b) / 6}
        \For{$ i = 1 : (n-1) $}
            \State{I\_simpson = I\_simpson + f\_int($ a + i h $) / 3}
        \EndFor
        \For{$ i = 1 : n $}
            \State{I\_simpson = I\_simpson + 2
                f\_int($ a + (i - 1 / 2) h $) / 3}
        \EndFor
        \State{I\_simpson = h $ \cdot $ I\_simpson}
    \end{algorithmic}
\end{algorithm}

In practice, we want to find an approximate value that is within a prescribed
    tolerance \textit{tol} of the integral $ I $ of a given function $ f(x) $
    over the interval $ [a, b] $.
Simply using a numerical integration method with $ n $ partition intervals
    cannot work effectively, since we do not know in advance how large $ n $
    should be chosen to obtain an approximation of $ I $ with the desired
    accuracy.

We choose an integration method and smaller number of intervals, e.g., 4 or 8
    intervals, and compute the numerical approximation of the integral.
We then double the number of intervals and compute another approximation $ I $.
If the absolute value of the difference between the new and old approximations
    is smaller than the required tolerance \textit{tol}, we declare the last
    computed approximation of the integral to be the approximate value of $ I $
    that we are looking for.
Otherwise, double the number of intervals again and repeat the process until two
    consecutive numerical integration approximations are within the desired
    tolerance \textit{tol} of each other.
This condition is called the stopping criterion for the algorithm, and can be
    written formally as
\begin{equation}
    | I_{new} - I_{old} | < tol,
    \label{eq:stopping-criterion}
\end{equation}
where $ I_{old} $ and $ I_{new} $ are the last two approximations of $ I $ that
    were computed.
The pseudocode for this method is given in Algorithm
    \ref{alg:stopping-criterion}.
\begin{algorithm}
    \caption{Pseudocode for computing an approximate value of an integral with
        given tolerance}
    \label{alg:stopping-criterion}
    \begin{algorithmic}
        \State{Input:}
        \State{\textit{tol} = prescribed tolerance}
        \State{I\_numerical($ n $) = result of the numerical integration rule
            with $ n $ intervals; any integration rule can be used}

        \State{}

        \State{Output:}
        \State{I\_approx = approximation of $ \int_{a}^{b} f(x) $ with
            tolerance \textit{tol}}

        \State{}

        \State{$ n = 4 $; I\_old = I\_numerical($ n $)}
        \Comment{4 intervals initial partition}
        \State{$ n = 2n $; I\_new = I\_numerical($ n $)}
        \While{abs(I\_new - I\_old) $ > $ \textit{tol}}
            \State{I\_old = I\_new}
            \State{$ n = 2 n $}
            \State{I\_new = I\_numerical($ n $)}
        \EndWhile
        \State{I\_approx = I\_new}
    \end{algorithmic}
\end{algorithm}

\subsection{A concrete example}
We want to find an approximate value for
\begin{equation*}
    I = \int_{0}^{2} e^{-x^2} dx
\end{equation*}
which is within $ 0.5\ 10^{-7} $ of $ I $.

We implement the algorithm from Algorithm \ref{alg:stopping-criterion} for each
    of the numerical integration methods to compare their convergence
    properties.
We choose $ tol = 0.5\ 10^{-7} $.
For an initial partition of the interval $ [0, 2] $ into $ n = 4 $ intervals,
    the following approximate values of $ I $ are found using the Midpoint,
    Trapezoidal, and Simpson's rules, respectively:
\begin{equation*}
    I_4^M = 0.88278895;\quad I_4^T = 0.88061863;\quad I_4^S = 0.88206551.
\end{equation*}

Then, we double the number of partition intervals and compute the numerical
    approximates corresponding to each method.
We keep doubling the number of partition intervals until the stopping criterion
    \eqref{eq:stopping-criterion} is satisfied.
The results are recorded below:
\begin{table}
    \center
    \begin{tabular}[c]{l|l|l|l}
        \hline
        \multicolumn{1}{c|}{No. Intervals} &
        \multicolumn{1}{c}{Midpoint Rule} &
        \multicolumn{1}{c}{Trapezoidal Rule} &
        \multicolumn{1}{c}{Simpson's Rule} \\
        \hline
        4 & 0.88278895 & 0.88061863 & 0.88206551 \\
        8 & 0.88226870 & 0.88170379 & 0.88208040 \\
        16 & 0.88212887 & 0.88198624 & 0.88208133 \\
        32 & 0.88209330 & 0.88205756 & 0.88208139 \\
        64 & 0.88208437 & 0.88207543 & \\
        128 & 0.88208214 & 0.88207990 & \\
        256 & 0.88208158 & 0.88208102 & \\
        512 & 0.88208144 & 0.88208130 & \\
        \hline
    \end{tabular}
\end{table}

\section{Interest Rate Curves. Zero rates and instantaneous rates}
The zero rate $ r(0, t) $ between time 0 and time $ t $ is the rate of return
    of a cash deposit made at time 0 and maturing at time $ t $.
If specified for all values of $ t $, then $ r(0, t) $ is called the zero rate
    curve and is a continuous function of $ t $.

We assume that interest is compounded continuously.
The value at time $ t $ of $ B(0) $ currency units is
\begin{equation}
    B(t) = \exp (t r(0, t)) B(0).
    \label{eq:interest-value-time-t}
\end{equation}
The value at time 0 of $ B(t) $ currency units at time $ t $ is
\begin{equation}
    B(0) = \exp (-t r(0, t)) B(t).
    \label{eq:interest-value-time-0}
\end{equation}

The instantaneous rate $ r(t) $ at time $ t $ is the rate of return of deposits
    made at time $ t $ and maturing at time $ t + dt $, where $ dt $ is
    infinitesimally small, i.e.,
\begin{equation*}
    r(t) = \lim_{dt \rightarrow 0} \frac{1}{dt} \frac{B(t + dt) - B(t)}{B(t)} =
        \frac{B'(t)}{B(t)}.
\end{equation*}
We conclude that $ B(t) $ satisfies the ordinary differential equation (ODE)
\begin{equation}
    \frac{B'(\tau)}{B(\tau)} = r(\tau), \quad \forall \tau > 0,
    \label{eq:interest-value-ode}
\end{equation}
with the initial condition that $ B(\tau) $ at time $ \tau = 0 $ must be equal
    to $ B(0) $.
By integrating \eqref{eq:interest-value-ode} between 0 and $ t > 0 $, it follows
    that
\begin{equation*}
    \int_{0}^{t} r(\tau) d\tau = \int_{0}^{t} \frac{B'(\tau)}{B(\tau)} d\tau =
        \ln (B(\tau)) |_{\tau=0}^{\tau=t} =
        \ln \left( \frac{B(t)}{B(0)} \right).
\end{equation*}
Therefore,
\begin{equation}
    B(t) = B(0) \exp \left( \int_{0}^{t} r(\tau) d\tau \right), \quad
        \forall t > 0.
    \label{eq:interest-value-integral}
\end{equation}

Formula \eqref{eq:interest-value-integral} gives the future value at time $ t $
    of a cash deposit made at time $ 0 < t $.
It can also be used to find the present value at time 0 of a cash deposit
    $ B(t) $ made at time $ t > 0 $, i.e.,
\begin{equation}
    B(0) = B(t) \exp \left( -\int_{0}^{t} r(\tau) d\tau \right), \quad
        \forall t > 0;
    \label{eq:interest-value-integral-time-0}
\end{equation}
The term $ \exp \left( -\int_{0}^{t} r(\tau) d\tau \right) $ from
    \eqref{eq:interest-value-integral-time-0} is called the discount factor.

From \eqref{eq:interest-value-time-t} and \eqref{eq:interest-value-integral}, it
    follows that
\begin{equation}
    r(0, t) = \frac{1}{t} \int_{0}^{t} r(\tau) d\tau.
    \label{eq:zero-rate-integral}
\end{equation}
The zero rate $ r(0, t) $ is the average of the instantaneous rate $ r(t) $ over
    the time interval $ [0, t] $.

If $ r(t) $ is continuous, then it is uniquely determined if the zero rate curve
    $ r(0, t) $ is known.
From \eqref{eq:zero-rate-integral}, we obtain that
\begin{equation}
    \int_{0}^{t} r(\tau) d\tau = t r(0, t).
    \label{eq:instantaneous-rate-integral}
\end{equation}
By differentiating \eqref{eq:instantaneous-rate-integral} with respect to $ t $,
    we find that
\begin{equation}
    r(t) = r(0, t) + t \frac{d}{dt} (r(0, t)).
    \label{eq:instantaneous-rate-governing}
\end{equation}

Formulas \eqref{eq:interest-value-time-t} and
    \eqref{eq:interest-value-integral-time-0} can also be written for times
    $ t_1 < t_2 $ instead of times 0 and $ t $, as follows:
\begin{align}
    B(t_2) &= B(t_1) \exp \left( \int_{t_1}^{t_2} r(\tau) d\tau \right),
        \quad \forall 0 < t_1 < t_2;
        \label{eq:interest-value-integral-t2} \\
    B(t_1) &= B(t_2) \exp \left( -\int_{t_1}^{t_2} r(\tau) d\tau \right),
        \quad \forall 0 < t_1 f, t_2.
        \label{eq:interest-value-integral-t1}
\end{align}

\subsection{Constant interest rates}
When the assumption that interest rates are constant is made, it is never
    mentioned whether the zero rate or the instantaneous rates are considered
    to be constant.
The reason is that if either one of these rates is constant and equal to $ r $,
    then the other rate is also constant and equal to $ r $, i.e.,
\begin{equation*}
    r(0, t) = r,\ \forall 0 \leq t \leq T \quad \Leftrightarrow \quad
        r(t) = r,\ \forall 0 \leq t \leq T.
\end{equation*}

To see this, assume that $ r(t) = r, \forall 0 \leq t \leq T $.
From \eqref{eq:zero-rate-integral}, we find that
\begin{equation*}
    r(0, t) = \frac{1}{t} \int_{0}^{t} r(\tau) d\tau =
        \frac{1}{t} \int_{0}^{t} r d\tau = r, \quad \forall 0 < t \leq T.
\end{equation*}
Since $ r(0, t) $ is continuous, we obtain that $ r(0, 0) = r $.

If $ r(0, t) = r, \forall 0 \leq t \leq T $, recall from
    \eqref{eq:instantaneous-rate-governing} that
\begin{equation*}
    r(t) = r(0, t) + t \frac{d}{dt} (r(0, t)) = r,\ \forall 0 < t < T.
\end{equation*}
Then $ r(0) = r $ and $ r(T) = r $ as well, since $ r(t) $ is continuous.

If interest rates are constant and equal to $ r $, the future value and present
    value formulas \eqref{eq:interest-value-integral},
    \eqref{eq:interest-value-integral-time-0},
    \eqref{eq:interest-value-integral-t2}, and
    \eqref{eq:interest-value-integral-t1} become
\begin{align}
    B(t) &= e^{rt} B(0), \quad \forall t > 0; \\
    B(t_2) &= e^{r(t_2 - t_1)} B(t_1), \quad \forall 0 < t_1 < t_2; \\
    B(0) &= e^{-rt} B(t), \quad \forall t > 0; \\
    B(t_1) &= e^{-r(t_2 - t_1)} B(t_2), \quad \forall 0 < t_1 < t_2.
\end{align}

\subsection{Forward Rates}
The forward rate of return $ r(0; t_1, t_2) $ between times $ t_1 $ and $ t_2 $
    is the constant rate of return, \textit{as seen at time 0}, of a deposit
    that will be made at time $ t_1 > 0 $ in the future and will mature at time
    $ t_2 > t_1 $.

An arbitrage-free value for the forward rate $ r(0; t_1, t_2) $ in terms of the
    zero rate curve $ r(0, t) $ can be found using the Law of One Price as
    follows.
Consider two different strategies for investing $ B(0) $ currency units at time
    0:

\paragraph{First Strategy:}
At time 0, deposit $ B(0) $ currency units until time $ t_1 $, with interest
    rate $ r(0, t_1) $.
Then, at $ t_1 $, deposit the proceeds until time $ t_2 $, at the forward rate
    $ r(0; t_1, t_2) $, which was locked in at time 0.
The value of the deposit at time $ t_1 $ is $ V_1(t_1) =
    B(0) \exp (t_1 r(0, t_1)) $.
At time $ t_2 $, the value is
\begin{align}
    \begin{split}
        V_1(t_2) &= V_1(t_1) \exp((t_2 - t_1) r(0; t_1, t_2)) \\
                 &= B(0) \exp ( t_1 r(0, t_1) + (t_2 - t_1) r(0; t_1, t_2)).
        \label{eq:forward-strategy-1}
    \end{split}
\end{align}

\paragraph{Second Strategy:}
Deposit $ B(0) $ at time 0 until time $ t_2 $, with interest rate $ r(0, t_2) $.
At time $ t_2 $, the value of the deposit is
\begin{equation}
    V_2(t_2) = B(0) \exp (t_2 r(0, t_2)).
    \label{eq:forward-strategy-2}
\end{equation}

Both investment strategies are risk free and the cash amount invested at time 0
    is the same, equal to $ B(0) $, for both strategies.
From the Law of One Price, it follows that $ V_1(t_2) = V_2(t_2) $.
From \eqref{eq:forward-strategy-1} and \eqref{eq:forward-strategy-2}, we find
    that
\begin{equation*}
    t_1 r(0, t_1) + (t_2 - t_1) r(0; t_1, t_2) = t_2 r(0, t_1).
\end{equation*}
By solving for $ r(0; t_1, t_2) $, we conclude that
\begin{equation}
    r(0; t_1, t_2) = \frac{t_2 r(0, t_2) - t_1 r(0, t_1)}{t_2 - t_1}.
    \label{eq:forward-rate}
\end{equation}

\subsection{Discretely compounded interest}
Assume that interest is compounded $ n $ times every year, and let
    $ r_n(0, t) $, for $ t \geq 0 $, denote the corresponding zero rate curve.
Then,
\begin{equation}
    B_n(t) = B(0) \left( 1 + \frac{r_n(0, t)}{n} \right)^{nt},
    \label{eq:discrete-compounded-interest}
\end{equation}
where $ B_n(t) $ is the amount that accumulates at time $ t $ from an amount
    $ B(0) $ at time 0 by compounding interest $ n $ times a year between 0 and
    $ t $.

The most common types of discretely compounded interest are:
\begin{itemize}
    \item annually compounded, i.e., once a year:
        \begin{equation*}
            B_1(t) = B(0) (1 + r_1(0, t))^t;
        \end{equation*}
    \item semiannually compounded, i.e., every six months:
        \begin{equation*}
            B_2(t) = B(0) \left( 1 + \frac{r_2(0, t)}{2} \right)^{2t};
        \end{equation*}
    \item quarterly compounded, i.e., every three months:
        \begin{equation*}
            B_4(t) = B(0) \left( 1 + \frac{r_4(0, t)}{4} \right)^{4t};
        \end{equation*}
    \item monthly compounded, i.e., every month:
        \begin{equation*}
            B_{12}(t) = B(0) \left( 1 + \frac{r_{12}(0, t)}{12} \right)^{12t}.
        \end{equation*}
\end{itemize}

Continuously compounded interest is the limiting case of discretely compounded
    interest, i.e., $ B_{cont} (t) = \lim_{n \rightarrow \infty} B_n(t) $.
Here, $ B_n(t) $ and $ B_{cont}(t) $ are given by
    \eqref{eq:discrete-compounded-interest} and
    \eqref{eq:interest-value-time-t}, respectively, i.e.,
    $ B_{cont}(t) = e^{tr(0, t)} B(0) $.

\section{Bond Pricing. Yield of a Bond. Bond Duration and Bond Convexity}
A bond is a financial instrument used to issue debt, i.e., to borrow money.
The issuer of the bond receives cash when the bond is issued, and must pay the
    face value (principal) of the bond at a certain time in the future call the
    maturity (expiry) of the bond.
Other payments by the issuer of the bond to the buyer of the bond, called coupon
    payments, may also be made at predetermined times in the future.
The price of the bond is equal to the sum of all future cash flows discounted to
    the present by using the risk-free zero rate.

Let $ B $ be the value of a bond with future cash flows $ c_i $ to be paid to
    the holder of the bond at times $ t_i $, $ i = 1 : n $.
Let $ r(0, t_i) $ be the continuously compounded zero rates corresponding to
    $ t_i $, $ i = 1 : n $.
Then,
\begin{equation}
    B = \sum_{i=1}^{n} c_i e^{-r(0, t_i)t_i}.
    \label{eq:bond-value}
\end{equation}
Note that $ e^{-r(0, t_i)t_i} $ is the discount factor corresponding to time
    $ t_i $, $ i = 1 : n $.
If the instantaneous interest rate curve $ r(t) $ is known, a formula similar
    to \eqref{eq:bond-value} can be given, by substituting the discount factor
    $ \exp \left( -\int_{0}^{t_i} r(\tau) d\tau \right) $ for
    $ e^{-r(0, t_i) t_i} $.
Then,
\begin{equation}
    B = \sum_{i=1}^{n} c_i \exp \left( -\int_{0}^{t_i} r(\tau) d\tau \right).
    \label{eq:bond-value-integral}
\end{equation}

\begin{definition}
    The yield of a bond is the internal rate of return of the bond, i.e., the
        constant rate at which the sum of the discounted future cash flows of
        the bond is equal to the price of the bond.
    If $ B $ is the price of a bond with cash flows $ c_i $ at time $ t_i $,
        $ i = 1 : n $, and if $ y $ is the yield of the bond, then,
    \begin{equation}
        B = \sum_{i=1}^{n} c_i e^{-yt_i}.
        \label{eq:bond-price}
    \end{equation}
\end{definition}

As expressed in \eqref{eq:bond-price}, the price of the bond $ B $ can be
    regarded as a function of the yield.
It is easy to see that the price of the bond goes down if the yield goes up, and
    vice versa.

To compute the yield of a bond with a known price $ B $, we must solve
    \eqref{eq:bond-price} for $ y $.
This can be written as a nonlinear equation in $ y $, i.e.,
\begin{equation*}
    f(y) = 0, \quad \text{where} \quad
    f(y) = \sum_{i=1}^{n} c_i e^{-y t_i} - B,
\end{equation*}
which is then solve numerically.

\begin{definition}
    Par yield is the coupon rate that makes the value of the bond equal to its
        face value.
\end{definition}

Duration and convexity are two of the most important parameters to estimate
    when investing in a bond, other than its yield.
Duration provides the sensitivity of the bond price with respect to small
    changes in the yield, while convexity distinguishes between two bond
    portfolios with the same duration.
(The portfolio with higher convexity is more desirable.)

The duration of a bond is the weighted time average of the future cash flows of
    the bond discounted with respect to the yield of the bond, and normalized by
    dividing by the price of the bond.

\begin{definition}
    The duration $ D $ of a bond with price $ B $ and yield $ y $, with cash
        flows $ c_i $ at time $ t_i $, $ i = 1 : n $, is
    \begin{equation}
        D = \frac{\sum_{i=1}^{n} t_i c_i e^{-yt_i}}{B}.
        \label{eq:bond-duration}
    \end{equation}
\end{definition}

From \eqref{eq:bond-price} and \eqref{eq:bond-duration}, it is easy to see that
\begin{equation*}
    \frac{\partial B}{\partial y} = -\sum_{i=1}^{n} t_i c_i e^{-yt_i} = -B D,
\end{equation*}
and therefore
\begin{equation}
    D = -\frac{1}{B} \frac{\partial B}{\partial y}.
    \label{eq:bond-duration-governing}
\end{equation}

The duration of a bond gives the relative change in the price of a bond for
    \textit{small} changes $ \Delta y $ in the yield of the bond (parallel
    shifts of the yield curve).
Let $ \Delta B $ be the corresponding change in the price of the bond, i.e.,
    $ \Delta B = B(y + \Delta y) - B(y) $.
The discretized version of \eqref{eq:bond-duration-governing} is
\begin{equation*}
    D \approx -\frac{1}{B} \frac{B(y + \Delta y) - B(y)}{\Delta y} =
        -\frac{\Delta B}{B \cdot y},
\end{equation*}
which is equivalent to
\begin{equation}
    \frac{\Delta B}{B} \approx -\Delta y D.
    \label{eq:bond-duration-governing-discrete}
\end{equation}

For very small parallel shifts in the yield curve, the approximation formula
    \eqref{eq:bond-duration-governing-discrete} is accurate.
For larger parallel shifts, convexity is used to better capture the effect of
    the changes in the yield curve on the price of the bond.
\begin{definition}
    The convexity $ C $ of a bond with price $ B $ and yield $ y $ is
    \begin{equation}
        C = \frac{1}{B} \frac{\partial^2 B}{\partial y^2}.
        \label{eq:bond-convexity-governing}
    \end{equation}
\end{definition}

Using \eqref{eq:bond-price}, it is easy to see that
\begin{equation*}
    C = \frac{\sum_{i=1}^{n} t_i^2 c_i e^{-yt_i}}{B}.
\end{equation*}

The following approximation of the percentage change in the price of the bond
    for a given change in the yield of the bond is more accurate than
    \eqref{eq:bond-duration-governing-discrete}:
\begin{equation*}
    \frac{\Delta B}{B} \approx -D \Delta y + \frac{1}{2} C (\Delta y)^2.
\end{equation*}

\subsection{Zero Coupon Bonds}
A zero coupon bond is a bond that pays back the face value of the bond at
    maturity and has no other payments, i.e., has coupon rate equal to 0.
If $ F $ is the face value of a zero coupon bond with maturity $ T $, the bond
    pricing formula \eqref{eq:bond-value} becomes
\begin{equation}
    B = F e^{-r(0, T)T},
    \label{eq:zero-coupon-bond-value}
\end{equation}
where $ B $ is the price of the bond at time 0 and $ r(0, T) $ is the zero rate
    corresponding to time $ T $.

If the instantaneous interest rate curve $ r(t) $ is given, the bond pricing
    formula \eqref{eq:bond-value-integral} becomes
\begin{equation}
    B = F \exp \left( -\int_{0}^{T} r(\tau) d\tau \right).
\end{equation}

Let $ y $ be the yield of the bond.
From \eqref{eq:bond-price}, we find that
\begin{equation}
    B = F e^{-y T}.
    \label{eq:zero-coupon-bond-price}
\end{equation}

From \eqref{eq:zero-coupon-bond-value} and \eqref{eq:zero-coupon-bond-price},
    we conclude that $ y = r(0, T) $.
The yield of a zero coupon bond is the same as the zero rate corresponding to
    the maturity of the bond.
This explains why the zero rate curve $ r(0, t) $ is also called the yield
    curve.

As expected, the duration of a zero coupon bond is equal to the maturity of the
    bond.
From \eqref{eq:bond-duration-governing} and \eqref{eq:zero-coupon-bond-price},
    we obtain that
\begin{equation*}
    D = -\frac{1}{B} \frac{\partial B}{\partial y} =
        -\frac{1}{F e^{-yT}} (-T F e^{-yT}) = T.
\end{equation*}
The convexity of a zero coupon bond can be computed from
    \eqref{eq:bond-convexity-governing} and \eqref{eq:zero-coupon-bond-price}:
\begin{equation*}
    C = \frac{1}{B} \frac{\partial^2 B}{\partial y^2} =
        \frac{1}{F e^{-yT}} (T^2 F e^{-yT}) = T^2.
\end{equation*}

\section{Numerical implementation of bond mathematics}
When specifying a bond, the maturity $ T $ of the bond, as well as the cash
    flows $ c_i $ and the cash flows dates $ t_i $, $ i = 1 : n $ are given.
The price of the bond can be obtained from formula \eqref{eq:bond-value}
    provided that the zero rate curve $ r(0, t) $ is known for any $ t > 0 $,
    or at least for the cash flow times, i.e., for $ t = t_i $, $ i = 1 : n $.

If a routine r\_zero($ t $) for computing the zero rate curve is given, the
    pseudocode from Algorithm \ref{alg:bond-price} can be used to compute the
    price of the bond.

If the instantaneous interest rate curve $ r(t) $ is known, the price of the
    bond is given by formula \eqref{eq:bond-value-integral}.
\begin{algorithm}
    \caption{Pseudocode for computing the bond price given the zero rate curve}
    \label{alg:bond-price}
    \begin{algorithmic}
        \State{Input:}
        \State{$ n $ = number of cash flows}
        \State{t\_cash\_flow = vector of cash flow dates (of size $ n $)}
        \State{v\_cash\_flow = vector of cash flows (of size $ n $)}
        \State{r\_zero($ t $) = zero rate corresponding to time $ t $}

        \State{}

        \State{Output:}
        \State{$ B $ = bond price}

        \State{}

        \State{$ B = 0 $}
        \For{$ i = 1 : n $}
            \State{disc($ i $) = exp( -t\_cash\_flow($ i $)
                r\_zero(t\_cash\_flow($ i $)) )}
            \State{$ B $ = $ B $ = v\_cash\_flow($ i $) disc($ i $)}
        \EndFor
    \end{algorithmic}
\end{algorithm}
If a closed formula for $ \int r(\tau) d\tau $ cannot be found, evaluating the
    discount factors $ disc(i) = \exp \left( -\int_{0}^{t_i} r(\tau) d\tau
    \right) $, $ i = 1 : n $, requires estimating
\begin{equation*}
    I_i \int_{0}^{t_i} r(\tau) d\tau, \quad \forall i = 1 : n,
\end{equation*}
using numerical integration methods.
This is done by setting a tolerance $ tol(i) $ for the numerical approximation
    of $ I_i $ and doubling the number of intervals in the partition of
    $ [0, t_i] $ until two consecutive approximations of $ I_i $ are within
    $ tol(i) $ of each other; see the pseudocode from Algorithm
    \ref{alg:bond-price-numerical-int} for more details.

\begin{algorithm}
    \caption{Pseudocode for computing the bond price given the instantaneous
        interest rate curve}
    \label{alg:bond-price-numerical-int}
    \begin{algorithmic}
        \State{Input:}
        \State{$ n $ = number of cash flows}
        \State{t\_cash\_flow = vector of cash flow dates (of size $ n $)}
        \State{v\_cash\_flow = vector of cash flows (of size $ n $)}
        \State{r\_inst($ t $) = instantaneous interest rate at time $ t $}
        \State{tol = vector of tolerances in the numerical approximation of
            discount factor integrals (of size $ n $)}

        \State{}

        \State{Output:}
        \State{$ B $ = bond price}

        \State{}

        \State{$ B = 0 $}
        \For{$ i = 1 : n $}
            \State{I\_numerical($ i $) = result of the numerical integration of
                r\_inst($ t $) on the \\\qquad\qquad interval
                [0, t\_cash\_flow($ i $)] with tolerance tol($ i $)}
            \State{disc($ i $) = exp( -I\_numerical($ i $)
                r\_zero(t\_cash\_flow($ i $)) )}
            \State{$ B $ = $ B $ = v\_cash\_flow($ i $) disc($ i $)}
        \EndFor
    \end{algorithmic}
\end{algorithm}

From a practical standpoint, we note that the cash flow at maturity
    $ c_n = 100 \left( 1 + \frac{C}{m} \right) $, is about two orders of
    magnitude higher than any other cash flow $ c_i = 100 \frac{C}{m} $,
    $ i < n $, where $ m $ is the frequency of annual cash flows, e.g.,
    $ m = 2 $ for a semiannual coupon bond.
Therefore, an optimal vector of tolerances $ tol $ has the first $ n - 1 $
    entries equal to each other, and the $ n $-th entry two orders of
    magnitude smaller than the previous entry, i.e.,
\begin{equation*}
    tol = \left[ \tau\ \tau ... \tau\ \frac{\tau}{100} \right].
\end{equation*}

\section{Exercise}

\subsection{Question 1}
Compute the integral of the function $ f(x, y) = x^2 - 2 y $ on the region
    bounded by the parabola $ y = (x + 1)^2 $ and the line $ y = 5 x - 1 $.

\paragraph{Answer}
To identify the integration domain $ D $, we note that
\begin{align*}
    (x + 1)^2 &= 5 x - 1 \\
    x^2 - 3 x + 2 &= 0 \\
    (x - 1)(x - 2) &= 0.
\end{align*}
So, $ x = 1 $ or $ x = 2 $ and that $ (x + 1)^2 \leq 5 x - 1 $ for
    $ 1 < x < 2 $.
Therefore,
\begin{equation*}
    D = {(x, y) | 1 \leq x \leq 2\ \text{and}\ (x + 1)^2 \leq y \leq 5 x - 1}.
\end{equation*}
Then,
\begin{align*}
    \int \int_D f(x, y) dx dy
        &= \int_{1}^{2} \left( \int_{(x+1)^2}^{5x-1} (x^2 - 2y) dy \right) dx \\
        &= \int_{1}^{2} \left. \left( x^2 y - y^2 \right)
            \right|_{(x+1)^2}^{5x-1} dx \\
        &= \int_{1}^{2} x^2 ((5x - 1) - (x + 1)^2) - ((5x - 1)^2 - (x + 1)^4)
            dx \\
        &= \int_{1}^{2} (5x - 1 - (x + 1)^2)(x^2 - (5x - 1 + (x + 1)^2)) dx \\
        &= \int_{1}^{2} (-x^2 + 3x - 2)(-7x) dx \\
        &= \int_{1}^{2} 7x^3 - 21x^2 + 14x dx \\
        &= \left. \left( \frac{7}{4} x^4 - 7 x^3 + 7 x^2 \right) \right|_1^2 \\
        &= -\frac{7}{4}
\end{align*}

\subsection{Question 2}
Let $ f : (0, \infty) \rightarrow \mathbb{R} $ denote the Gamma function, i.e.
    let
\begin{equation*}
    f(\alpha) = \int_{0}^{\infty} x^{\alpha - 1} e^{-x} dx.
\end{equation*}

\subsubsection{Part (i)}
Show that $ f(\alpha) $ is well defined for any $ \alpha > 0 $, i.e., show that
    both
\begin{equation*}
    \int_{0}^{1} x^{\alpha - 1} e^{-x} dx = \lim_{t \rightarrow 0}
        \int_{t}^{1} x^{\alpha - 1} e^{-x} dx
\end{equation*}
and
\begin{equation*}
    \int_{1}^{\infty} x^{\alpha - 1} e^{-x} dx = \lim_{t \rightarrow \infty}
        \int_{1}^{t} x^{\alpha - 1} e^{-x} dx
\end{equation*}
exist and are finite.

\paragraph{Answer}
Let $ \alpha > 0 $.
Intuitively, as $ x \searrow 0 $, the function $ x^{\alpha - 1} e^{-x} $ is on
    the order of $ x^{\alpha - 1} $ since $ \lim_{x \searrow 0} e^{-x} = 1 $.
Since
\begin{align*}
    \lim_{t \searrow 0} \int_{t}^{1} x^{\alpha - 1} dx
        &= \lim_{t \searrow 0} \left. \frac{x^\alpha}{\alpha}  \right|_t^1 \\
        &= \frac{1}{\alpha} \lim_{t \searrow 0} (1 - t^\alpha) \\
        &= \frac{1}{\alpha},
\end{align*}
it follows that
\begin{equation*}
    \int_{0}^{1} x^{\alpha - 1} e^{-x} dx =
        \lim_{t \searrow 0} \int_{t}^{1} x^{\alpha - 1} e^{-x} dx
\end{equation*}
exists and is finite (upper bounded by $ \frac{1}{\alpha} $.

Similarly, intuitively, as $ x \rightarrow \infty $, the function
    $ x^{\alpha - 1} e^{-x} $ is on the order of $ e^{-x} $, since the
    exponential function dominates at infinity.
Since
\begin{equation*}
    \lim_{t \rightarrow \infty} \int_{1}^{t} e^{-x} dx =
        \lim_{t \rightarrow \infty} (1 - e^{-t}) = 1,
\end{equation*}
it follows that
\begin{equation*}
    \int_{1}^{\infty} x^{\alpha - 1} e^{-x} dx =
        \lim_{t \rightarrow \infty} \int_{1}^{t} x^{\alpha - 1} e^{-x} dx
\end{equation*}
exists and is finite.

The prove the second part rigorously, we need to prove that, for any
    $ \epsilon > 0 $, there exists $ n(\epsilon) > 0 $ such that
\begin{equation*}
    \int_{s}^{\infty} x^{\alpha - 1} e^{-x} dx < \epsilon, \quad
        \forall s > n(\epsilon).
\end{equation*}

There exists $ N > 0 $ such that
\begin{equation*}
    x^{\alpha - 1} e^{-x} < e^{-\frac{x}{2}}, \quad \forall x > N,
\end{equation*}
since
\begin{equation*}
    \lim_{x \rightarrow \infty} x^{\alpha - 1} e^{-\frac{x}{2}} = 0.
\end{equation*}

Since $ \lim_{x \rightarrow \infty} e^{-\frac{x}{2}} = 0 $, it follows that,
    for any $ \epsilon > 0 $, there exists $ m(\epsilon) > 0 $ such that
\begin{equation*}
    2 e^{-\frac{m(\epsilon}{2}} < \epsilon.
\end{equation*}

Choose $ n(\epsilon) = \max (m(\epsilon), N) $, we obtain that
\begin{align*}
    x^{\alpha - 1} e^{-x} &< e^{-\frac{x}{2}}, \quad \forall x > n(\epsilon); \\
    2 e^{-\frac{n(\epsilon)}{2}} &< \epsilon.
\end{align*}

For any $ s > n(\epsilon) $,
\begin{align*}
    \int_{s}^{\infty} x^{\alpha - 1} e^{-x} dx
        &= \lim_{t \rightarrow \infty} \int_{s}^{t} x^{\alpha - 1} e^{-x} dx \\
        &< \lim_{t \rightarrow \infty} \int_{s}^{t} e^{-\frac{x}{2}} dx \\
        &= \lim_{t \rightarrow \infty} \left( -2 e^{-\frac{t}{2}} +
            2 e^{-\frac{s}{2}} \right) \\
        &= 2 e^{-\frac{s}{2}} \\
        &< 2 e^{-\frac{n(\epsilon)}{2}} \\
        &< \epsilon,
\end{align*}

\subsubsection{Part (ii)}
Prove, using integration by parts, that $ f(\alpha) = (\alpha - 1)
    f(\alpha - 1) $ for any $ \alpha > 1 $.
Show that $ f(1) = 1 $ and conclude that, for any $ n \geq 1 $ positive integer,
    $ f(n) = (n - 1)! $.

\paragraph{Answer}
\begin{align*}
    f(\alpha)
        &= \int_{0}^{\infty} x^{\alpha - 1} e^{-x} dx \\
        &= \left. \left( -x^{\alpha - 1} e^{-x} \right) \right|_{0}^{\infty} -
            \int_{0}^{\infty} -(\alpha - 1) x^{\alpha - 2} e^{-x} dx \\
        &= (\alpha - 1) \int_{0}^{\infty} x^{\alpha - 2} e^{-x} dx, \quad
            \because \lim_{x \rightarrow \infty} e^{-x} = 0 \\
        &= (\alpha - 1) f(\alpha - 1) \\
    f(1)
        &= \int_{0}^{\infty} e^{-x} dx \\
        &= -e^{-x} |_0^{\infty} \\
        &= -(0 - 1) \\
        &= 1
\end{align*}
By induction, $ f(n) = (n - 1)! $.

\subsection{Question 3}
Compute an approximate value of $ \int_{1}^{3} \sqrt{x} e^{-x} dx $ using the
    Midpoint rule, the Trapezoidal rule, and Simpson's rule.
Start with $ n = 4 $ intervals, and double the number of intervals until two
    consecutive approximations are within $ 10^{-6} $ of each other.

\paragraph{Answer}
The approximate values can be found in the table below:
\begin{table}
    \center
    \begin{tabular}[c]{l|l|l|l}
        \hline
        \multicolumn{1}{c|}{No. Intervals} &
        \multicolumn{1}{c}{Midpoint Rule} &
        \multicolumn{1}{c}{Trapezoidal Rule} &
        \multicolumn{1}{c}{Simpson's Rule} \\
        \hline
        4   & 0.40715731 & 0.41075744 & 0.40835735 \\
        8   & 0.40807542 & 0.40895737 & 0.40836940 \\
        16  & 0.40829719 & 0.40851640 & 0.40837019 \\
        32  & 0.40835199 & 0.40840674 & \\
        64  & 0.40836569 & 0.40837937 & \\
        128 & 0.40836911 & 0.40837253 & \\
        256 & 0.40836996 & 0.40837082 & \\
        512 &            & 0.40837039 & \\
        \hline
    \end{tabular}
\end{table}
The approximate value of the integral is 0.408370, and is obtained for a 256
    intervals partition using the Midpoint rule, for a 512 intervals partition
    using the Trapezoidal rule, and for a 16 intervals partition using
    Simpson's rule.

\subsection{Question 4}
Let $ f : \mathbb{R} \rightarrow \mathbb{R} $ given by
    $ f(x) = \frac{x^{5/2}}{1 + x^2} $.

\subsubsection{Part (i)}
Use Midpoint rule with $ tol = 10^{-6} $ to compute an approximation of
\begin{equation*}
    I = \int_{0}^{1} f(x) dx = \int_{0}^{1} \frac{x^{5/2}}{1 + x^2}.
\end{equation*}

\paragraph{Answer}
The approximate value of the integral is 0.179171, and is obtained for a 512
    intervals partitions on the interval $ [0, 1] $
\begin{table}
    \center
    \begin{tabular}[c]{l|l}
        \hline
        \multicolumn{1}{c|}{No. Intervals} &
        \multicolumn{1}{c}{Midpoint Rule} \\
        \hline
        4   & 0.17715737 \\
        8   & 0.17867774 \\
        16  & 0.17904866 \\
        32  & 0.17914062 \\
        64  & 0.17916354 \\
        128 & 0.17916926 \\
        256 & 0.17917070 \\
        512 & 0.17917105 \\
        \hline
    \end{tabular}
\end{table}

\subsubsection{Part (ii)}
Show that $ f^{(4)} (x) $ is not bounded on the interval $ (0, 1) $.

\paragraph{Answer}
The fourth derivative of the numerator $ x^{5/2} $ is on the order of
    $ x^{-3/2} $, which is not defined at 0.
The denominator $ 1 + x^2 $ is bounded away from 0, so $ f^{(4)}(x) $ is not
    bounded on the interval $ (0, 1) $.

\subsubsection{Part (iii)}
Apply Simpson's rule with $ n = 2^k $, $ k = 2 : 8 $, intervals to compute the
    integral $ I $.
Conclude that Simpson's rule converges, although the theoretical estimate
    cannot be used to infer convergence in this case since $ f^{(4)}(x) $ is
    unbounded on $ (0, 1) $.

\paragraph{Answer}
The approximate value of the integral is 0.179171, and is obtained for a 32
    intervals partitions on the interval $ [0, 1] $
\begin{table}
    \center
    \begin{tabular}[c]{l|l}
        \hline
        \multicolumn{1}{c|}{No. Intervals} &
        \multicolumn{1}{c}{Simpson's Rule} \\
        \hline
        4  & 0.179155099725056 \\
        8  & 0.179169815603871 \\
        16 & 0.179171055067087 \\
        32 & 0.179171162051226 \\
        \hline
    \end{tabular}
\end{table}

\subsection{Question 5}
Let $ K $, $ T $, $ \sigma $, and $ r $ be positive constants.
Define the function $ g : \mathbb{R} \rightarrow \mathbb{R} $ as
\begin{equation*}
    g(x) = \frac{1}{\sqrt{2 \pi}} \int_{-\infty}^{b(x)}
        e^{-\frac{y^2}{2}} dy,
\end{equation*}
where $ b(x) = \left( \ln \left( \frac{x}{K} \right) + \left( r +
    \frac{\sigma^2}{2} \right) T \right) / \left( \sigma \sqrt{T} \right) $.
Compute $ g'(x) $.

\paragraph{Answer}
Let $ g(x) = C \int_{-\infty}^{b(x)} f(y) dy $.
\begin{align*}
    g'(x)
        &= C f(b(x)) b'(x) \\
        &= \frac{1}{x \sigma \sqrt{2 \pi T}} \exp \left( -\frac{\left(
            \ln \left( \frac{x}{K} \right) + \left( r + \frac{\sigma^2}{2}
            \right) T \right)^2}{2 \sigma^2 T} \right)
\end{align*}

\subsection{Question 6}
Let $ h(x) $ be a function such that $ \int_{-\infty}^{\infty} |xh(x)| dx $
    exists.
Define $ g(t) $ by
\begin{equation*}
    g(t) = \int_{t}^{\infty} (x - t) h(x) dx,
\end{equation*}
and show that
\begin{equation*}
    \frac{\partial^2 g}{\partial t^2} = h(t).
\end{equation*}

\paragraph{Answer}
Recall that if $ a(t) $ and $ b(t) $ are differentiable functions, and if
$ f(x, t) $ is a continuous function, then
\begin{equation*}
    \frac{d}{dt} \left( \int_{a(t)}^{b(t)} f(x) dx \right) =
        f(b(t)) b'(t) - f(a(t)) a'(t).
\end{equation*}
We derive a similar result for improper integrals, i.e.,
\begin{equation*}
    \frac{d}{dt} \left( \int_{a(t)}^{\infty} f(x, t) dx \right) =
        \int_{a(t)}^{\infty} \frac{\partial f}{\partial t} (x, t) dx -
        f(a(t), t) a'(t).
\end{equation*}

For our problem,
\begin{equation*}
    a(t) = t, \qquad \text{and} \qquad f(x, t) = (x - t) h(x).
\end{equation*}
We conclude that
\begin{equation*}
    g'(t) = \frac{d}{dt} \left( \int_{t}^{\infty} (x - t) h(x) dx \right) =
        -\int_{t}^{\infty} h(x) dx,
\end{equation*}
since $ f(a(t), t) = f(t, t) = (t - t)h(t) = 0 $.

Since
\begin{equation*}
    \frac{d}{dt} \left( \int_{a(t)}^{\infty} f(x) dx \right) =
        -f(a(t), t) a'(t),
\end{equation*}
it follows that
\begin{equation*}
    g''(t) = h(t).
\end{equation*}
